<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Pokémon</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .pokemon-header { text-align: center; margin-bottom: 30px; }
        .pokemon-name { font-size: 2.5em; color: #333; margin: 10px 0; }
        .pokemon-id { font-size: 1.2em; color: #666; }
        .pokemon-image { width: 150px; height: 150px; margin: 15px 0; }
        .pokemon-types { display: flex; justify-content: center; align-items: center; gap: 10px; margin: 15px 0; }
        .type-badge { padding: 5px 15px; border-radius: 20px; color: white; font-weight: bold; text-align: center; display: inline-flex; align-items: center; justify-content: center; min-width: 60px; }
        .type-plante { background-color: #78C850; }
        .type-poison { background-color: #A040A0; }
        .type-feu { background-color: #F08030; }
        .type-eau { background-color: #6890F0; }
        .type-normal { background-color: #A8A878; }
        .type-electrik { background-color: #F8D030; }
        .type-glace { background-color: #98D8D8; }
        .type-vol { background-color: #A890F0; }
        .type-psy { background-color: #F85888; }
        .type-combat { background-color: #C03028; }
        .type-sol { background-color: #E0C068; }
        .type-insecte { background-color: #A8B820; }
        .type-roche { background-color: #B8A038; }
        .type-spectre { background-color: #705898; }
        .type-dragon { background-color: #7038F8; }
        .type-tenebres { background-color: #000000;}
        .type-acier { background-color: #B8B8D0; }
        .type-fee { background-color: #EE99AC; }
        
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0; }
        .info-section { background: #f9f9f9; padding: 15px; border-radius: 8px; }
        .info-section h3 { margin-top: 0; color: #333; border-bottom: 2px solid #ddd; padding-bottom: 5px; }
        .info-row { display: flex; justify-content: space-between; margin: 8px 0; }
        .info-label { font-weight: bold; }
        
        .evolution-section { grid-column: span 2; }
        .sensibilites-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px; }
        .sensibilite-item { display: flex; justify-content: space-between; align-items: center; padding: 5px; border-radius: 5px; }
        .sensibilite-item.faible { background-color: #ffebee; }
        .sensibilite-item.resistant { background-color: #e8f5e8; }
        .sensibilite-item.immunise { background-color: #f3e5f5; }
        .sensibilite-item.normal { background-color: #f5f5f5; }
        .sensibilite-badge { padding: 3px 8px; border-radius: 12px; font-size: 0.8em; color: white; }
        .score { font-weight: bold; font-size: 0.9em; }
        
        .capacites-section { margin-top: 30px; }
        .capacites-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .capacites-table th, .capacites-table td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        .capacites-table th { background-color: #f2f2f2; font-weight: bold; }
        .capacites-table tr:nth-child(even) { background-color: #f9f9f9; }
        .niveau-badge { background: #007bff; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.9em; text-align: center; display: inline-block; min-width: 30px; }
        
        .back-link { display: inline-block; margin-bottom: 20px; color: #007bff; text-decoration: none; }
        .back-link:hover { text-decoration: underline; }
        .error { text-align: center; color: #d32f2f; font-size: 1.2em; }
        .navigation { display: flex; justify-content: space-between; align-items: center; margin: 20px 0; }
        .nav-btn { padding: 10px 20px; background: #007bff; color: white; text-decoration: none; border-radius: 5px; border: none; cursor: pointer; }
        .nav-btn:hover { background: #0056b3; }
        .nav-btn:disabled { background: #ccc; cursor: not-allowed; }
    </style>
</head>
<body>
    <div class="container">
        <a href="liste_pokemon_gen1_grid.html" class="back-link">← Retour à la liste</a>
        
        <div class="navigation">
            <button id="prev-btn" class="nav-btn" onclick="navigatePokemon(-1)">← Précédent</button>
            <span id="pokemon-counter"></span>
            <button id="next-btn" class="nav-btn" onclick="navigatePokemon(1)">Suivant →</button>
        </div>
        
        <div id="pokemon-content">
            <div class="error">Chargement...</div>
        </div>
    </div>

    <script>
        async function loadPokemonData() {
            try {
                const pokemonResponse = await fetch('pokemon_data.json');
                const attacksResponse = await fetch('attacks.json');
                const pokemonData = await pokemonResponse.json();
                const attacksData = await attacksResponse.json();
                return { pokemon: pokemonData, attacks: attacksData };
            } catch (error) {
                console.error('Erreur lors du chargement des données:', error);
                return null;
            }
        }

        function getTypeClass(type) {
            return 'type-' + type.toLowerCase().replace('é', 'e');
        }

        function displayPokemon(pokemon) {
            const content = document.getElementById('pokemon-content');
            
            const typesHtml = pokemon.type.map(type => 
                `<span class="type-badge ${getTypeClass(type)}">${type}</span>`
            ).join('');

            let evolutionHtml = '';
            if (pokemon.evolution === "n'évolue pas") {
                evolutionHtml = `
                    <div class="info-section evolution-section">
                        <h3>Évolution</h3>
                        <div class="info-row">
                            <span class="info-label">Statut:</span>
                            <span>N'évolue pas</span>
                        </div>
                    </div>
                `;
            } else if (Array.isArray(pokemon.evolution)) {
                // Évoli avec plusieurs évolutions
                const evolutions = pokemon.evolution.map(evo => {
                    if (evo.pierre) {
                        return `${evo.nom} (${evo.pierre})`;
                    }
                    return evo.nom;
                }).join(', ');
                evolutionHtml = `
                    <div class="info-section evolution-section">
                        <h3>Évolutions</h3>
                        <div class="info-row">
                            <span class="info-label">Peut évoluer en:</span>
                            <span>${evolutions}</span>
                        </div>
                    </div>
                `;
            } else if (pokemon.evolution && typeof pokemon.evolution === 'object') {
                let condition = '';
                if (pokemon.evolution.niveau) {
                    condition = `niveau ${pokemon.evolution.niveau}`;
                } else if (pokemon.evolution.pierre) {
                    condition = pokemon.evolution.pierre;
                } else if (pokemon.evolution.echange) {
                    condition = 'échange';
                }
                evolutionHtml = `
                    <div class="info-section evolution-section">
                        <h3>Évolution</h3>
                        <div class="info-row">
                            <span class="info-label">Évolue en:</span>
                            <span>${pokemon.evolution.nom} (${condition})</span>
                        </div>
                    </div>
                `;
            }

            const sensibilitesHtml = `
                <div class="info-section">
                    <h3>Sensibilités</h3>
                    <div class="sensibilites-grid">
                        ${Object.entries(pokemon.sensibilites).map(([type, score]) => {
                            let scoreClass = '';
                            let scoreText = '';
                            if (score === 2) {
                                scoreClass = 'faible';
                                scoreText = 'x2';
                            } else if (score === 0.5) {
                                scoreClass = 'resistant';
                                scoreText = 'x0.5';
                            } else if (score === 0) {
                                scoreClass = 'immunise';
                                scoreText = 'x0';
                            } else {
                                scoreClass = 'normal';
                                scoreText = 'x1';
                            }
                            return `<div class="sensibilite-item ${scoreClass}">
                                <span class="sensibilite-badge ${getTypeClass(type)}">${type}</span>
                                <span class="score">${scoreText}</span>
                            </div>`;
                        }).join('')}
                    </div>
                </div>
            `;

            const capacitesHtml = pokemon.capacites.length > 0 ? `
                <div class="capacites-section">
                    <h3>Capacités apprises par expérience</h3>
                    <table class="capacites-table">
                        <thead>
                            <tr>
                                <th>Niveau</th>
                                <th>Attaque</th>
                                <th>Nom</th>
                                <th>Type</th>
                                <th>Description</th>
                                <th>Dé</th>
                                <th>Effet</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${pokemon.capacites.map(capacite => {
                                const attack = window.attacksData[capacite.attaque];
                                if (attack) {
                                    return `
                                        <tr>
                                            <td><span class="niveau-badge">${capacite.niveau}</span></td>
                                            <td>${attack.attaque || ''}</td>
                                            <td><strong>${attack.nom}</strong></td>
                                            <td><span class="type-badge ${getTypeClass(attack.type)}">${attack.type}</span></td>
                                            <td>${attack.description || ''}</td>
                                            <td>${attack.de || ''}</td>
                                            <td>${attack.effet || ''}</td>
                                        </tr>
                                    `;
                                } else {
                                    // Afficher même si l'attaque n'existe pas dans attacks.json
                                    return `
                                        <tr style="background-color: #fff3cd;">
                                            <td><span class="niveau-badge">${capacite.niveau}</span></td>
                                            <td><em>${capacite.attaque}</em></td>
                                            <td><strong>Attaque non trouvée</strong></td>
                                            <td>-</td>
                                            <td><em>Données manquantes</em></td>
                                            <td>-</td>
                                            <td>-</td>
                                        </tr>
                                    `;
                                }
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            ` : '<div class="capacites-section"><p>Aucune capacité renseignée pour le moment.</p></div>';

            content.innerHTML = `
                <div class="pokemon-header">
                    <div class="pokemon-id">#${pokemon.id.toString().padStart(3, '0')}</div>
                    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${pokemon.id}.png" 
                         alt="${pokemon.nom}" class="pokemon-image" 
                         onerror="this.src='https://via.placeholder.com/150x150?text=?'">
                    <h1 class="pokemon-name">${pokemon.nom}</h1>
                    <div class="pokemon-types">${typesHtml}</div>
                </div>
                
                <div class="info-grid">
                    <div class="info-section">
                        <h3>Informations générales</h3>
                        <div class="info-row">
                            <span class="info-label">Taille:</span>
                            <span>${pokemon.taille}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Poids:</span>
                            <span>${pokemon.poids}</span>
                        </div>
                    </div>
                    
                    ${sensibilitesHtml}
                    ${evolutionHtml}
                </div>
                
                ${capacitesHtml}
            `;
        }

        function navigatePokemon(direction) {
            const currentId = parseInt(new URLSearchParams(window.location.search).get('id'));
            const newId = currentId + direction;
            
            if (newId >= 1 && newId <= 151) {
                window.location.href = `pokemon_new.html?id=${newId}`;
            }
        }

        function updateNavigation(currentId) {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const counter = document.getElementById('pokemon-counter');
            
            prevBtn.disabled = currentId <= 1;
            nextBtn.disabled = currentId >= 151;
            counter.textContent = `${currentId} / 151`;
        }

        async function init() {
            const urlParams = new URLSearchParams(window.location.search);
            const pokemonId = urlParams.get('id');
            
            if (!pokemonId) {
                document.getElementById('pokemon-content').innerHTML = 
                    '<div class="error">Aucun Pokémon spécifié. Veuillez sélectionner un Pokémon depuis la liste.</div>';
                return;
            }

            const data = await loadPokemonData();
            
            if (!data) {
                document.getElementById('pokemon-content').innerHTML = 
                    '<div class="error">Erreur lors du chargement des données.</div>';
                return;
            }

            window.attacksData = data.attacks;
            const pokemon = data.pokemon[pokemonId];
            
            if (!pokemon) {
                document.getElementById('pokemon-content').innerHTML = 
                    '<div class="error">Pokémon non trouvé.</div>';
                return;
            }

            displayPokemon(pokemon);
            updateNavigation(parseInt(pokemonId));
            document.title = `${pokemon.nom} - Hakai Kousen`;
        }

        // Navigation au clavier
        document.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowLeft') {
                navigatePokemon(-1);
            } else if (e.key === 'ArrowRight') {
                navigatePokemon(1);
            }
        });

        init();
    </script>
</body>
</html>